# RTT Geo-Location Anomaly Detector

What is RTT Geo-Location Anomaly Detector ?

RTT Geo-Location Anomaly Detector ( ***RTT GAD*** ) is a Wireshark plugin written in Lua that analyzes the Round-Trip Time ( RTT ) of TCP and TLS packets and compares it with an expected average value for the country associated with the IP address, using a MaxMind geolocation database. The goal is to determine whether the host is actually located in the region corresponding to its registered IP address ( *or if it is masking its true location using technologies such as VPNs, Tor, intermediate caches/CDNs, etc...* )

---

## ü§∏ Quickstart

To get started with **RTT Geo-Location Anomaly Detector (RTT GAD)**, follow these steps:

### 1Ô∏è‚É£ Install the MaxMind GeoIP2 Country Database

Download the **GeoLite2 Country** database (free with registration) or another GeoIP2 Country database from [MaxMind's official site](https://www.maxmind.com/en/geoip-databases).

You can also follow this helpful video tutorial for guidance:  
üîó [YouTube ‚Äì How to Download GeoLite2](https://www.youtube.com/watch?v=IlVppluWTHw)

Once downloaded, extract the `.mmdb` file and keep it ready‚Äîyou'll configure the plugin to use this.

---

### 2Ô∏è‚É£ Install the Lua Plugin

Move the `rtt_check.lua` script to Wireshark‚Äôs plugin directory. Wireshark automatically loads Lua plugins placed in these directories depending on your OS:

- **Windows**:  
  `C:\Program Files\Wireshark\plugins\<version>\`
  
- **macOS**:  
  `/Applications/Wireshark.app/Contents/PlugIns/wireshark/<version>/`
  
- **Linux**:  
  `/usr/lib/wireshark/plugins/<version>/`

You can also use the **personal plugin directory**, which can be found directly from Wireshark:

#### GUI Method (recommended):
1. Open Wireshark.
2. Click on `Help` ‚Üí `About Wireshark`.
3. Go to the `Folders` tab.
4. Click the link next to `Personal Plugins`.
5. Move the `rtt_check.lua` script into this folder.
6. Restart Wireshark to load the plugin.

---

### 3Ô∏è‚É£ Add the RTT Statistics File

Move the `ntp_rtt_stats.txt` file (generated by the Python script) into the **main Wireshark directory** (same path where the main Wireshark executable is installed or where your plugin expects to find data files).

Make sure that the `rtt_check.lua` script can read this file at runtime to function properly.

---

Now you're ready to start analyzing RTT anomalies and detecting geo-location inconsistencies!



---

## ‚öôÔ∏è Funzionamento

### 1. Raccolta RTT - `generator.py`
Questo script invia richieste NTP a server pubblici in diversi paesi, calcola:
- RTT medio (`mean`)
- Deviazione standard (`std`)
  
Il risultato √® salvato in `ntp_rtt_stats.txt` nel seguente formato:
IT: 38.42 4.91 US: 105.89 12.32 JP: 278.56 18.97 ...

### 2. Analisi RTT - `rtt_check.lua`
Lo script Lua si integra in Wireshark come plugin:
- Analizza pacchetti TCP SYN o pacchetti ICMP Echo (ping)
- Calcola l‚ÄôRTT osservato
- Confronta con i dati medi dal file `ntp_rtt_stats.txt`
- Se l‚ÄôRTT osservato √® significativamente diverso (>2√óstd), viene segnalato come **anomalia**

Ogni anomalia √® visualizzata nella finestra di Wireshark, all‚Äôinterno del tree del pacchetto, come:
[RTT Geo Check] RTT observed: 40 ms, Expected: 130 ¬± 20 ms ‚Üí Possibile VPN / CDN

---

## üß™ Esempio di utilizzo

1. Lancia lo script Python:
   ```bash
   python3 generator.py
Verr√† generato ntp_rtt_stats.txt aggiornato.

Apri Wireshark con il plugin rtt_check.lua installato.

Analizza un file .pcap con traffico TCP o ICMP.
Il plugin evidenzier√† pacchetti sospetti nella colonna "Info" o nel tree del pacchetto.

üìå Requisiti
Wireshark v3.4 o superiore con supporto a Lua

Python 3.x

Connessione Internet (per generare RTT reali)

Python Dependencies:
ntplib

json

concurrent.futures

Installa con:

bash
Copia
Modifica
pip install ntplib
üîé Idee future e miglioramenti
Aggiunta del fingerprinting QUIC (versioni, user agent, parametri di handshake)

Esportazione automatica dei pacchetti anomali

Report PDF o HTML con classificazione degli IP sospetti

Integrazione con GeoIP (MaxMind) per visualizzare mappe

üìÑ Licenza
Progetto accademico realizzato per fini didattici e di ricerca sulla sicurezza informatica.
Autore: Nicol√≤ Fontanarosa
Universit√†: Universit√† di Pisa
Anno: 2025
